<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTO Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.group3.dao.NftDao">

    <resultMap id="nftResultMap" type="Nft">
        <id property="nftId" column="nft_id"/>
        <result property="nftSignature" column="nft_signature"/>
        <result property="nftUrl" column="nft_url"/>
        <result property="nftPrice" column="nft_price"/>
        <result property="nftDescription" column="nft_description"/>
        <result property="nftLikes" column="nft_likes"/>
        <result property="nftDeleted" column="nft_deleted"/>
        <result property="nftVersion" column="nft_version"/>
        <result property="nftUserId" column="nft_userid"/>
    </resultMap>


    <select id="selectTest" resultMap="nftResultMap">
        select *
        from tb_nft
        where nft_deleted != 1
    </select>

    <insert id="insertNft">
        INSERT INTO public.tb_nft(
            nft_signature, nft_url, nft_price, nft_description, nft_likes, nft_version, nft_userid)
        VALUES (#{nft.nftSignature}, #{nft.nftUrl}, #{nft.nftPrice}, #{nft.nftDescription}, #{nft.nftLikes}, #{nft.nftVersion}, #{nft.nftUserId});
    </insert>

    <select id="selectAllNftsByUserId" resultMap="nftResultMap">
        SELECT nft_id, nft_signature, nft_url, nft_price, nft_description, nft_likes, nft_deleted, nft_version, nft_userid
        FROM tb_nft
        Where nft_userid = #{userid} and nft_version = 0
        ORDER BY nft_id ASC
    </select>

    <update id="modifyNftVersionAndPrice">
         UPDATE tb_nft
	     SET  nft_version = 1 , nft_price = #{nft.nftPrice}
	     WHERE nft_id= #{nft.nftId}
    </update>

    <select id="selectAllNftOnSellByUserId" resultMap="nftResultMap">
        SELECT nft_id, nft_signature, nft_url, nft_price, nft_description, nft_likes, nft_deleted, nft_version, nft_userid
        FROM tb_nft
        Where nft_userid = #{userid} and nft_version = 1
        ORDER BY nft_id ASC
    </select>

    <select id="selectNftByNftId"  resultMap="nftResultMap">
        SELECT nft_id, nft_signature, nft_url, nft_price, nft_description, nft_likes, nft_deleted, nft_version, nft_userid
        FROM tb_nft
        Where nft_id = #{nftid}
    </select>
</mapper>